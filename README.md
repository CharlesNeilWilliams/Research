This is the code I used, mainly for backup.